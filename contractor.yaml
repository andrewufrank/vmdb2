worker-image: ~/tmp/contractor/worker-vmdb2.img
install:
  - build-essential
  - python3-all
  - python3-coverage-test-runner
  - python3-cliapp
  - python3-jinja2
  - python3-yaml
  - qemu-utils
  - parted
  - kpartx
  - debootstrap
  - dosfstools
  - ansible
  - moreutils
  - git
  - cmdtest
  - pandoc
source: .
# We build many huge images, and there's no use for them, so don't
# save them.
# workspace: ~/tmp/contractor/vmdb2
build: |
  export LC_ALL=C.UTF-8

  ./check

  # /dev/vdb is an extra, big disk we can use for scratch space.
  sudo sh -x ./check-external /workspace

  cd /workspace
  sudo sh -x ./src/check-all buster.tar.gz
  sudo chmod -R a+rX /workspace
